/*
Jquery Iframe Auto Height Plugin
Version 1.2.0 (20.02.2013)

Author : Ilker Guller (http://ilkerguller.com)

Description: This plugin can get contents of iframe and set height of iframe automatically. Also it has cross-domain fix (*).
Details: http://github.com/Sly777/Iframe-Height-Jquery-Plugin
*/

(function(b){var e={resizeMaxTry:4,resizeWaitTime:50,minimumHeight:200,defaultHeight:3E3,heightOffset:0,exceptPages:"",debugMode:!1,visibilitybeforeload:!1,blockCrossDomain:!1,externalHeightName:"bodyHeight",onMessageFunctionName:"getHeight",domainName:"*"};b.iframeHeight=function(h,f){var d,e,a=this;b.iframeHeight.resizeTimeout=null;b.iframeHeight.resizeCount=0;a.$el=b(h);a.el=h;a.$el.data("iframeHeight",a);var g;d=navigator.userAgent;d=d.toLowerCase();e=/(chrome)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+)/.exec(d)||
    /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(d)||/(msie) ([\w.]+)/.exec(d)||0>d.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(d)||[];d=e[1]||"";e=e[2]||"0";g={chrome:!1,safari:!1,mozilla:!1,msie:!1,webkit:!1};d&&(g[d]=!0,g.version=e);g.chrome?g.webkit=!0:g.webkit&&(g.safari=!0);a.debug={FirstTime:!0,Init:function(){"console"in window||(console={});"log info warn error dir clear".replace(/\w+/g,function(a){a in console||(console[a]=console.log||new Function)})},Log:function(c){this.FirstTime&&
    !0===this.FirstTime&&(this.Init(),this.FirstTime=!1);a.options.debugMode&&(!0===a.options.debugMode&&console&&(null!==c||""!==c))&&console.log(c)},GetBrowserInfo:g};a.resetIframe=function(){a.options.visibilitybeforeload&&!(a.debug.GetBrowserInfo.msie&&"7.0"==a.debug.GetBrowserInfo.version)&&a.$el.css("visibility","hidden");a.debug.Log("Old Height is "+a.$el.height()+"px");a.$el.css("height","").removeAttr("height");a.debug.Log("Reset iframe");a.debug.Log("Height is "+a.$el.height()+"px after reset")};
    a.resizeFromOutside=function(c){if(a.options.blockCrossDomain)return a.debug.Log("Blocked cross domain fix"),!1;if(void 0===c)return!1;a.resetIframe();var b=parseInt(c.data)+a.options.heightOffset+"px";a.$el.height(b);a.options.visibilitybeforeload&&!(a.debug.GetBrowserInfo.msie&&"7.0"==a.debug.GetBrowserInfo.version)&&a.$el.css("visibility","visible");a.debug.Log("Got height from outside. Height is "+(parseInt(c.data)+a.options.heightOffset)+"px");return!0};a.checkMessageEvent=function(){if(a.options.blockCrossDomain||
        a.debug.GetBrowserInfo.msie&&"7.0"==a.debug.GetBrowserInfo.version)return a.debug.Log("Blocked cross domain fix"),!1;a.resetIframe();a.options.visibilitybeforeload&&!(a.debug.GetBrowserInfo.msie&&"7.0"==a.debug.GetBrowserInfo.version)&&a.$el.css("visibility","visible");window.addEventListener?window.addEventListener("message",a.resizeFromOutside,!1):window.attachEvent&&window.attachEvent("onmessage",a.resizeFromOutside);var c=document.getElementById(a.$el.attr("id")),b=a.options.onMessageFunctionName;
        if(c.contentWindow.postMessage)c.contentWindow.postMessage(b,"*");else return a.debug.Log("Your browser does not support the postMessage method!"),!1;a.debug.Log("Cross Domain Iframe started");return!0};var j=function(){b.iframeHeight.resizeCount<=a.options.resizeMaxTry?(b.iframeHeight.resizeCount++,b.iframeHeight.resizeTimeout=setTimeout("$.iframeHeight.resizeIframe()",a.options.resizeWaitTime),a.debug.Log(b.iframeHeight.resizeCount+" time(s) tried")):(clearTimeout(b.iframeHeight.resizeTimeout),
        b.iframeHeight.resizeCount=0,a.$el.height(a.options.defaultHeight+a.options.heightOffset).css("height",a.options.defaultHeight+a.options.heightOffset),a.options.visibilitybeforeload&&!(a.debug.GetBrowserInfo.msie&&"7.0"==a.debug.GetBrowserInfo.version)&&a.$el.css("visibility","visible"),a.debug.Log("set default height for iframe = "+(a.options.defaultHeight+a.options.heightOffset)+"px"))};a.sendInfotoTop=function(){if(0<top.length&&"undefined"!=typeof JSON){var c={};c[a.options.externalHeightName].value=
        document.body.scrollHeight;c=JSON.stringify(c);top.postMessage(c,"*");a.debug.Log("sent info to top page");return!1}return!0};b.iframeHeight.resizeIframe=function(){a.resetIframe();var c;try{var b=a.$el.get(0).contentDocument.location.href;a.debug.Log("This page is non-Cross Domain - "+b);c=!1}catch(d){a.debug.Log("This page is Cross Domain"),c=!0}c?(a.$el.height(a.options.defaultHeight+a.options.heightOffset).css("height",a.options.defaultHeight+a.options.heightOffset),a.options.visibilitybeforeload&&
        !(a.debug.GetBrowserInfo.msie&&"7.0"==a.debug.GetBrowserInfo.version)&&a.$el.css("visibility","visible"),a.checkMessageEvent()):(a.$el.css("height")===a.options.minimumHeight+"px"&&a.resetIframe(),null!==a.$el.get(0).contentWindow.document.body?(a.debug.Log("This page has body info"),c=a.$el.get(0).contentWindow.document.body.scrollHeight,b=a.$el.get(0).contentWindow.document.location.pathname.substring(window.location.pathname.lastIndexOf("/")+1).toLowerCase(),a.debug.Log("page height : "+c+"px || page name : "+
        b),c<=a.options.minimumHeight&&-1==a.options.exceptPages.indexOf(b)?j():c>a.options.minimumHeight&&-1==a.options.exceptPages.indexOf(b)&&(a.$el.height(c+a.options.heightOffset).css("height",c+a.options.heightOffset),a.options.visibilitybeforeload&&!(a.debug.GetBrowserInfo.msie&&"7.0"==a.debug.GetBrowserInfo.version)&&a.$el.css("visibility","visible"),a.debug.Log("Now iframe height is "+(c+a.options.heightOffset)+"px"))):(a.debug.Log("This page has not body info"),j()))};a.init=function(){a.options=
        b.extend({},b.iframeHeight.defaultOptions,f);a.debug.Log(a.options);if(void 0===a.$el.get(0).tagName||"iframe"!==a.$el.get(0).tagName.toLowerCase())return a.debug.Log("This element is not iframe!"),!1;b.iframeHeight.resizeIframe();a.$el.load(function(){b.iframeHeight.resizeIframe()});return!0};a.init()};b.iframeHeight.defaultOptions=e;b.fn.iframeHeight=function(e){return this.each(function(){new b.iframeHeight(this,e)})};b.iframeHeightExternal=function(){function h(f){var d;"domain"in f&&(d=f.domain);
    "origin"in f&&(d=f.origin);"*"!==e.domainName&&d!==e.domainName?b.iframeHeight.debug.Log("It's not same domain. Blocked!"):f.data==e.onMessageFunctionName&&f.source.postMessage(document.body.scrollHeight,f.origin)}1===arguments.length&&b.isPlainObject(arguments[0])&&(e=arguments[0]);window.addEventListener?window.addEventListener("message",h,!1):window.attachEvent&&window.attachEvent("onmessage",h)}})(jQuery);