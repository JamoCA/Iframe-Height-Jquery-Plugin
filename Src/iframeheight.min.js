/*
Jquery Iframe Auto Height Plugin
Version 1.1.0 (27.08.2012)

Author : Ilker Guller (http://ilkerguller.com)

Description: This plugin can get contents of iframe and set height of iframe automatically. Also it has cross-domain fix (*).
Details: http://github.com/Sly777/Iframe-Height-Jquery-Plugin
*/

(function(b){b.iframeHeight=function(e,h){var a=this;b.iframeHeight.resizeTimeout=null;b.iframeHeight.resizeCount=0;a.$el=b(e);a.el=e;a.$el.data("iframeHeight",a);var c={FirstTime:!0,Init:function(){"console"in window||(console={});"log info warn error dir clear".replace(/\w+/g,function(a){a in console||(console[a]=console.log||new Function)})},Log:function(b){this.FirstTime&&!0===this.FirstTime&&(this.Init(),this.FirstTime=!1);a.options.debugMode&&(!0===a.options.debugMode&&console&&(null!==b||""!==
b))&&console.log(b)}};a.resetIframe=function(){a.options.visibilitybeforeload&&!(b.browser.msie&&7==b.browser.version)&&a.$el.css("visibility","hidden");c.Log("Old Height is "+a.$el.height()+"px");a.$el.css("height","").removeAttr("height");c.Log("Reset iframe");c.Log("Height is "+a.$el.height()+"px after reset")};a.resizeFromOutside=function(d){if(a.options.blockCrossDomain)return c.Log("Blocked cross domain fix"),!1;if(void 0===d)return!1;a.resetIframe();var d=JSON.parse(d.data),e=parseInt(d[a.options.externalHeightName])+
a.options.heightOffset+"px";a.$el.height(e);a.options.visibilitybeforeload&&!(b.browser.msie&&7==b.browser.version)&&a.$el.css("visibility","visible");c.Log("Got height from outside. Height is "+(parseInt(d[a.options.externalHeightName])+a.options.heightOffset)+"px")};a.checkMessageEvent=function(){if(a.options.blockCrossDomain)return c.Log("Blocked cross domain fix"),!1;window.addEventListener?window.addEventListener("message",a.resizeFromOutside.apply(a,arguments)):window.attachEvent&&window.attachEvent("onmessage",
a.resizeFromOutside.apply(a,arguments));c.Log("Cross Domain Iframe started")};var g=function(){b.iframeHeight.resizeCount<=a.options.resizeMaxTry?(b.iframeHeight.resizeCount++,b.iframeHeight.resizeTimeout=setTimeout("$.iframeHeight.resizeIframe()",a.options.resizeWaitTime),c.Log(b.iframeHeight.resizeCount+" time(s) tried")):(clearTimeout(b.iframeHeight.resizeTimeout),b.iframeHeight.resizeCount=0,a.$el.height(a.options.defaultHeight+a.options.heightOffset).css("height",a.options.defaultHeight+a.options.heightOffset),
a.options.visibilitybeforeload&&!(b.browser.msie&&7==b.browser.version)&&a.$el.css("visibility","visible"),c.Log("set default height for iframe = "+(a.options.defaultHeight+a.options.heightOffset)+"px"))};a.sendInfotoTop=function(){if(0<top.length&&"undefined"!=typeof JSON){var b={};b[a.options.externalHeightName].value=document.body.scrollHeight;b=JSON.stringify(b);top.postMessage(b,"*");c.Log("sent info to top page");return!1}};b.iframeHeight.resizeIframe=function(){a.resetIframe();var d;try{a.$el.get(0),
c.Log("This page is non-Cross Domain"),d=!1}catch(e){c.Log("This page is Cross Domain"),d=!0}if(d)a.$el.height(a.options.defaultHeight+a.options.heightOffset).css("height",a.options.defaultHeight+a.options.heightOffset),a.options.visibilitybeforeload&&!(b.browser.msie&&7==b.browser.version)&&a.$el.css("visibility","visible"),a.checkMessageEvent();else if(a.$el.css("height")===a.options.minimumHeight+"px"&&a.resetIframe(),null!==a.$el.get(0).contentWindow.document.body){c.Log("This page has body info");
d=a.$el.get(0).contentWindow.document.body.scrollHeight;var f=a.$el.get(0).contentWindow.document.location.pathname.substring(window.location.pathname.lastIndexOf("/")+1).toLowerCase();c.Log("page height : "+d+"px || page name : "+f);d<=a.options.minimumHeight&&-1==a.options.exceptPages.indexOf(f)?g():d>a.options.minimumHeight&&-1==a.options.exceptPages.indexOf(f)&&(a.$el.height(d+a.options.heightOffset).css("height",d+a.options.heightOffset),a.options.visibilitybeforeload&&!(b.browser.msie&&7==b.browser.version)&&
a.$el.css("visibility","visible"),c.Log("Now iframe height is "+(d+a.options.heightOffset)+"px"))}else c.Log("This page has not body info"),g()};a.init=function(){a.options=b.extend({},b.iframeHeight.defaultOptions,h);c.Log(a.options);if(void 0===a.$el.get(0).tagName||"iframe"!==a.$el.get(0).tagName.toLowerCase())return c.Log("This element is not iframe!"),!1;b.iframeHeight.resizeIframe();a.$el.load(function(){b.iframeHeight.resizeIframe()})};a.init()};b.iframeHeight.defaultOptions={resizeMaxTry:4,
resizeWaitTime:50,minimumHeight:200,defaultHeight:1E3,heightOffset:0,exceptPages:"",debugMode:!1,visibilitybeforeload:!1,blockCrossDomain:!1,externalHeightName:"bodyHeight"};b.fn.iframeHeight=function(e){return this.each(function(){new b.iframeHeight(this,e)})}})(jQuery);