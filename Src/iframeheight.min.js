/*
Jquery Iframe Auto Height Plugin
Version 1.0.0 (21.06.2012)

Author : Ilker Guller (http://ilkerguller.com)

Description: This plugin can get contents of iframe and set height of iframe automatically. Also it has cross-domain fix (*).
Details: http://github.com/Sly777/Iframe-Height-Jquery-Plugin
*/

(function(c){c.iframeHeight=function(e,g){var a=this;c.iframeHeight.resizeTimeout=null;c.iframeHeight.resizeCount=0;a.$el=c(e);a.el=e;a.$el.data("iframeHeight",a);var d={FirstTime:!0,Init:function(){"console"in window||(console={});"log info warn error dir clear".replace(/\w+/g,function(a){a in console||(console[a]=console.log||new Function)})},Log:function(b){this.FirstTime&&!0===this.FirstTime&&(this.Init(),this.FirstTime=!1);a.options.debugMode&&(!0===a.options.debugMode&&console&&(null!==b||""!==
b))&&console.log(b)}};a.resetIframe=function(){a.options.visibilitybeforeload&&a.$el.css("visibility","hidden");a.$el.css("height","").removeAttr("height");d.Log("Reset iframe")};a.resizeFromOutside=function(b){if(a.options.blockCrossDomain)return d.Log("Blocked cross domain fix"),!1;if(void 0===b)return!1;a.resetIframe();b=JSON.parse(b.data);b=parseInt(b.bodyHeight)+a.options.heightOffset+"px";a.$el.height(b);a.options.visibilitybeforeload&&a.$el.css("visibility","visible");d.Log("Got height from outside")};
a.checkMessageEvent=function(){if(a.options.blockCrossDomain)return d.Log("Blocked cross domain fix"),!1;window.addEventListener?window.addEventListener("message",a.resizeFromOutside.apply(a,arguments)):window.attachEvent&&window.attachEvent("onmessage",a.resizeFromOutside.apply(a,arguments));d.Log("Cross Domain Iframe started")};var f=function(){c.iframeHeight.resizeCount<=a.options.resizeMaxTry?(c.iframeHeight.resizeCount++,c.iframeHeight.resizeTimeout=setTimeout("$.iframeHeight.resizeIframe()",
a.options.resizeWaitTime),d.Log(c.iframeHeight.resizeCount+" time(s) tried")):(clearTimeout(c.iframeHeight.resizeTimeout),c.iframeHeight.resizeCount=0,a.$el.height(a.options.defaultHeight+a.options.heightOffset).css("height",a.options.defaultHeight+a.options.heightOffset),a.options.visibilitybeforeload&&a.$el.css("visibility","visible"),d.Log("set default height for iframe = "+(a.options.defaultHeight+a.options.heightOffset)+"px"))};a.sendInfotoTop=function(){if(0<top.length&&"undefined"!=typeof JSON){var a=
{bodyHeight:document.body.scrollHeight},a=JSON.stringify(a);top.postMessage(a,"*");d.Log("sent info to top page");return!1}};c.iframeHeight.resizeIframe=function(){a.resetIframe();var b;try{a.$el.get(0),d.Log("This page is non-cdi"),b=!1}catch(c){d.Log("This page is cdi"),b=!0}if(b)a.$el.height(a.options.defaultHeight+a.options.heightOffset).css("height",a.options.defaultHeight+a.options.heightOffset),a.options.visibilitybeforeload&&a.$el.css("visibility","visible"),a.checkMessageEvent();else if(a.$el.css("height")===
a.options.minimumHeight+"px"&&a.resetIframe(),null!==a.$el.get(0).contentWindow.document.body){d.Log("This page has body info");b=a.$el.get(0).contentWindow.document.body.scrollHeight;var e=a.$el.get(0).contentWindow.document.location.pathname.substring(window.location.pathname.lastIndexOf("/")+1).toLowerCase();d.Log("page height : "+b+"px || page name : "+e);b<=a.options.minimumHeight&&-1==a.options.exceptPages.indexOf(e)?f():b>a.options.minimumHeight&&-1==a.options.exceptPages.indexOf(e)&&(a.$el.height(b+
a.options.heightOffset).css("height",b+a.options.heightOffset),a.options.visibilitybeforeload&&a.$el.css("visibility","visible"),d.Log("Now iframe height is "+(b+a.options.heightOffset)+"px"))}else d.Log("This page has not body info"),f()};a.init=function(){a.options=c.extend({},c.iframeHeight.defaultOptions,g);d.Log(a.options);if(void 0===a.$el.get(0).tagName||"iframe"!==a.$el.get(0).tagName.toLowerCase())return d.Log("This element is not iframe!"),!1;c.iframeHeight.resizeIframe();a.$el.load(function(){c.iframeHeight.resizeIframe()})};
a.init()};c.iframeHeight.defaultOptions={resizeMaxTry:4,resizeWaitTime:50,minimumHeight:200,defaultHeight:1E3,heightOffset:0,exceptPages:"",debugMode:!1,visibilitybeforeload:!1,blockCrossDomain:!1};c.fn.iframeHeight=function(e){return this.each(function(){new c.iframeHeight(this,e)})}})(jQuery);